<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å…ƒç´ å°çƒæ¶ˆæ¶ˆæ¨‚ğŸ¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, sans-serif; background: #f5f1ff; display: flex; justify-content: center; min-height: 100vh; color: #333; }
    .app { width: 100%; max-width: 480px; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
    .title-box { text-align: center; margin-top: 4px; }
    .title { font-size: 20px; font-weight: 700; color: #7b2fa0; }
    .subtitle { font-size: 12px; color: #777; margin-top: 2px; }
    .select-row { display: flex; justify-content: flex-start; align-items: center; gap: 8px; font-size: 13px; flex-wrap: wrap; }
    .select-row.space-between { justify-content: space-between; }
    select, .toggle-btn { padding: 6px 8px; border-radius: 12px; border: 1px solid #d4c9f0; background: #fff; font-size: 13px; }
    .toggle-btn { cursor: pointer; background: #eee5ff; border-color: #c5b4ef; min-width: 40px; text-align: center; }
    .toggle-btn.active { background: #a03aef; color: #fff; border-color: #7b1ed3; }
    button.start-btn, button.end-btn { padding: 8px 16px; border-radius: 16px; border: none; color: #fff; font-size: 14px; cursor: pointer; }
    button.start-btn { background: #a03a6f; }
    button.end-btn { background: #d9534f; display: none; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .level-display { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; display: none; }
    .fall-area { position: relative; height: 38vh; min-height: 200px; border-radius: 16px; background: radial-gradient(circle at top, #ffeefe 0, #f7f3ff 40%, #e7e6ff 100%); box-shadow: 0 6px 16px rgba(0,0,0,0.12); overflow: hidden; }
    .fall-petal { position: absolute; width: 50px; height: 50px; border-radius: 70%; background: radial-gradient(circle at 20% 15%, #fff2fb 0, #f7b8dd 60%, #f58ec4 100%); display: flex; flex-direction: column; justify-content: center; text-align: center; color: #5b1033; font-size: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.18); }
    .fall-num { font-size: 10px; opacity: 0.8; }
    .fall-lose-line { position: absolute; bottom: 40px; width: 100%; height: 2px; background: rgba(220,20,60,0.75); }
    .fall-lose-label { position: absolute; bottom: 42px; right: 8px; background: rgba(255,255,255,0.9); padding: 2px 6px; font-size: 10px; border-radius: 999px; color: #b00020; }
    .miss-bar { position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; background: rgba(255,255,255,0.85); padding: 2px 6px; border-radius: 999px; font-size: 10px; align-items: center; }
    .miss-dot { width: 10px; height: 10px; border-radius: 50%; background: #ffb3c1; }
    .miss-dot.used { background: #d7263d; }
    .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.46); color: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 14px; z-index: 10; }
    .overlay button { padding: 8px 14px; border-radius: 12px; border: none; background: #a03a6f; color: #fff; margin-top: 10px; font-size: 14px; cursor: pointer; }
    .confetti { position: absolute; pointer-events: none; z-index: 5; }
    .congrats-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #f093fb, #f5576c); color: #fff; padding: 15px 30px; border-radius: 20px; font-size: 18px; font-weight: bold; z-index: 20; animation: popIn 0.5s ease-out; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0); } 50% { transform: translate(-50%, -50%) scale(1.2); } 100% { transform: translate(-50%, -50%) scale(1); } }
    .table-wrapper { overflow-x: auto; padding-bottom: 4px; width: 100%; }
    .table-area { background: #fff; padding: 12px; border-radius: 14px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); }
    .table-grid { display: grid; grid-template-columns: repeat(18, minmax(22px, 1fr)); gap: 2px; }
    .element-cell { border-radius: 10px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .has-element { cursor: pointer; background: #faf8ff; border: 1px solid #ded8ff; }
    .has-element:hover { background: #efe8ff; }
    .correct { animation: flashC 0.35s; }
    .wrong { animation: flashW 0.35s; }
    @keyframes flashC { from { box-shadow: 0 0 0 0 rgba(76,175,80,0.4); } to { box-shadow: 0 0 0 6px rgba(76,175,80,0); } }
    @keyframes flashW { from { box-shadow: 0 0 0 0 rgba(244,67,54,0.4); } to { box-shadow: 0 0 0 6px rgba(244,67,54,0); } }
  </style>
</head>
<body>
<div class="app">
  <div class="title-box">
    <div class="title">å…ƒç´ å°çƒæ¶ˆæ¶ˆæ¨‚ğŸ¯</div>
    <div class="subtitle">åœ‹ä¸­ï¼é«˜ä¸­ï¼å…¨å…ƒç´ </div>
  </div>
  <div class="select-row">
    <span>ç¯„åœï¼š</span>
    <select id="rangeSelect"><option value="junior">åœ‹ä¸­</option><option value="senior">é«˜ä¸­</option><option value="full">å…¨å…ƒç´ </option></select>
    <span class="level-display" id="levelDisplay">ç­‰ç´š 1</span>
  </div>
  <div class="select-row space-between">
    <div><span>éŸ³æ•ˆï¼š</span><button id="soundToggle" class="toggle-btn active">é–‹</button></div>
    <div><button id="startBtn" class="start-btn">é–‹å§‹éŠæˆ²</button> <button id="endBtn" class="end-btn">çµæŸéŠæˆ²</button></div>
  </div>
  <div class="select-row space-between">
    <div>å¾—åˆ†ï¼š<span id="score">0</span></div>
    <div>ä¸‹ç´šï¼š<span id="nextLevel">50</span></div>
    <div>éŒ¯èª¤ï¼š<span id="missCount">0</span>/<span id="missLimit">0</span></div>
  </div>
  <div class="fall-area" id="fallArea">
    <div class="fall-lose-line"></div>
    <div class="fall-lose-label">æ‰åˆ°é€™è£¡=éŒ¯èª¤</div>
    <div class="miss-bar" id="missBar"><span style="color:#b00020;">éŒ¯èª¤çƒï¼š</span></div>
    <div class="overlay" id="overlay">
      <h2>æº–å‚™é–‹å§‹</h2>
      <p>æ¯ç­”å°50å€‹åŠ é€Ÿ<br>200å€‹éé—œæ”¾å½©ç´™ğŸ‰</p>
      <button id="overlayStart">é–‹å§‹</button>
    </div>
  </div>
  <div class="table-area">
    <div class="table-wrapper">
      <div class="table-grid" id="tableGrid"></div>
    </div>
  </div>
</div>
<script>
const ALL_ELEMENTS=[{num:1,symbol:"H",nameZh:"æ°«",period:1,group:1},{num:2,symbol:"He",nameZh:"æ°¦",period:1,group:18},{num:3,symbol:"Li",nameZh:"é‹°",period:2,group:1},{num:4,symbol:"Be",nameZh:"éˆ¹",period:2,group:2},{num:5,symbol:"B",nameZh:"ç¡¼",period:2,group:13},{num:6,symbol:"C",nameZh:"ç¢³",period:2,group:14},{num:7,symbol:"N",nameZh:"æ°®",period:2,group:15},{num:8,symbol:"O",nameZh:"æ°§",period:2,group:16},{num:9,symbol:"F",nameZh:"æ°Ÿ",period:2,group:17},{num:10,symbol:"Ne",nameZh:"æ°–",period:2,group:18},{num:11,symbol:"Na",nameZh:"éˆ‰",period:3,group:1},{num:12,symbol:"Mg",nameZh:"é‚",period:3,group:2},{num:13,symbol:"Al",nameZh:"é‹",period:3,group:13},{num:14,symbol:"Si",nameZh:"çŸ½",period:3,group:14},{num:15,symbol:"P",nameZh:"ç£·",period:3,group:15},{num:16,symbol:"S",nameZh:"ç¡«",period:3,group:16},{num:17,symbol:"Cl",nameZh:"æ°¯",period:3,group:17},{num:18,symbol:"Ar",nameZh:"æ°¬",period:3,group:18},{num:19,symbol:"K",nameZh:"é‰€",period:4,group:1},{num:20,symbol:"Ca",nameZh:"éˆ£",period:4,group:2},{num:21,symbol:"Sc",nameZh:"éˆ§",period:4,group:3},{num:22,symbol:"Ti",nameZh:"éˆ¦",period:4,group:4},{num:23,symbol:"V",nameZh:"é‡©",period:4,group:5},{num:24,symbol:"Cr",nameZh:"é‰»",period:4,group:6},{num:25,symbol:"Mn",nameZh:"éŒ³",period:4,group:7},{num:26,symbol:"Fe",nameZh:"éµ",period:4,group:8},{num:27,symbol:"Co",nameZh:"éˆ·",period:4,group:9},{num:28,symbol:"Ni",nameZh:"é³",period:4,group:10},{num:29,symbol:"Cu",nameZh:"éŠ…",period:4,group:11},{num:30,symbol:"Zn",nameZh:"é‹…",period:4,group:12},{num:31,symbol:"Ga",nameZh:"éµ",period:4,group:13},{num:32,symbol:"Ge",nameZh:"éº",period:4,group:14},{num:33,symbol:"As",nameZh:"ç ·",period:4,group:15},{num:34,symbol:"Se",nameZh:"ç¡’",period:4,group:16},{num:35,symbol:"Br",nameZh:"æº´",period:4,group:17},{num:36,symbol:"Kr",nameZh:"æ°ª",period:4,group:18},{num:37,symbol:"Rb",nameZh:"éŠ£",period:5,group:1},{num:38,symbol:"Sr",nameZh:"é¶",period:5,group:2},{num:39,symbol:"Y",nameZh:"é‡”",period:5,group:3},{num:40,symbol:"Zr",nameZh:"é‹¯",period:5,group:4},{num:41,symbol:"Nb",nameZh:"éˆ®",period:5,group:5},{num:42,symbol:"Mo",nameZh:"é‰¬",period:5,group:6},{num:43,symbol:"Tc",nameZh:"é€",period:5,group:7},{num:44,symbol:"Ru",nameZh:"é‡•",period:5,group:8},{num:45,symbol:"Rh",nameZh:"éŠ ",period:5,group:9},{num:46,symbol:"Pd",nameZh:"éˆ€",period:5,group:10},{num:47,symbol:"Ag",nameZh:"éŠ€",period:5,group:11},{num:48,symbol:"Cd",nameZh:"é˜",period:5,group:12},{num:49,symbol:"In",nameZh:"éŠ¦",period:5,group:13},{num:50,symbol:"Sn",nameZh:"éŒ«",period:5,group:14},{num:51,symbol:"Sb",nameZh:"éŠ»",period:5,group:15},{num:52,symbol:"Te",nameZh:"ç¢²",period:5,group:16},{num:53,symbol:"I",nameZh:"ç¢˜",period:5,group:17},{num:54,symbol:"Xe",nameZh:"æ°™",period:5,group:18},{num:55,symbol:"Cs",nameZh:"éŠ«",period:6,group:1},{num:56,symbol:"Ba",nameZh:"é‹‡",period:6,group:2},{num:57,symbol:"La",nameZh:"é‘­",period:6,group:3},{num:74,symbol:"W",nameZh:"é¢",period:6,group:6},{num:78,symbol:"Pt",nameZh:"é‰‘",period:6,group:10},{num:79,symbol:"Au",nameZh:"é‡‘",period:6,group:11},{num:80,symbol:"Hg",nameZh:"æ±",period:6,group:12},{num:86,symbol:"Rn",nameZh:"æ°¡",period:7,group:18}];
const JUNIOR=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,26,29,30,47,50,53];
const SENIOR=[...JUNIOR,21,22,23,24,25,27,28,31,32,33,34,35,36,37,38,39,40,41,42,44,45,46,48,49,51,52,54,55,56,57,74,78,79,80];
const FULL=ALL_ELEMENTS.map(e=>e.num);
const getPool=r=>ALL_ELEMENTS.filter(e=>(r==="junior"?JUNIOR:r==="senior"?SENIOR:FULL).includes(e.num));
const LEVELS=[{interval:3200,speed:0.18},{interval:2400,speed:0.24},{interval:1800,speed:0.32}];

const $=id=>document.getElementById(id);
const rangeSelect=$("rangeSelect"),soundToggle=$("soundToggle"),startBtn=$("startBtn"),endBtn=$("endBtn");
const fallArea=$("fallArea"),missBar=$("missBar"),overlay=$("overlay"),overlayStart=$("overlayStart");
const scoreEl=$("score"),missCountEl=$("missCount"),missLimitEl=$("missLimit"),levelDisplay=$("levelDisplay"),nextLevelEl=$("nextLevel"),tableGrid=$("tableGrid");

let running=false,petals=[],pool=[],score=0,missCount=0,missLimit=0,lastTime=null,spawnTimer=0,spawnInterval=3200,fallSpeed=0.18,level=1,milestones=new Set(),soundOn=true;

function setupGrid(p){
  tableGrid.innerHTML="";
  const map={};p.forEach(e=>map[e.period+"-"+e.group]=e);
  for(let r=1;r<=7;r++)for(let c=1;c<=18;c++){
    const cell=document.createElement("div");
    cell.className="element-cell";
    const e=map[r+"-"+c];
    if(e){cell.classList.add("has-element");cell.textContent=e.symbol;cell.onclick=()=>clickCell(e.symbol,cell);}
    tableGrid.appendChild(cell);
  }
}
function createDots(){
  missBar.innerHTML='<span style="color:#b00020;">éŒ¯èª¤çƒï¼š</span>';
  for(let i=0;i<missLimit;i++){const d=document.createElement("div");d.className="miss-dot";missBar.appendChild(d);}
}
function updateDots(){missBar.querySelectorAll(".miss-dot").forEach((d,i)=>d.classList.toggle("used",i<missCount));}
function setMissLimit(r){missLimit=r==="junior"?15:r==="senior"?12:10;missLimitEl.textContent=missLimit;createDots();updateDots();}
function setLevel(l){level=Math.min(l,3);const s=LEVELS[level-1];spawnInterval=s.interval;fallSpeed=s.speed;levelDisplay.textContent="ç­‰ç´š "+level;nextLevelEl.textContent=level>=3?"MAX!":level*50;}
function checkLevel(){const nl=Math.min(3,Math.floor(score/50)+1);if(nl>level){setLevel(nl);playSound("levelup");}}
function checkMilestone(){const m=Math.floor(score/200)*200;if(m>0&&!milestones.has(m)){milestones.add(m);celebrate(m);}}
function celebrate(m){
  confetti();playSound("celebrate");
  const msg=document.createElement("div");msg.className="congrats-msg";msg.innerHTML="ğŸ‰ æ­å–œé”æˆ "+m+" åˆ†ï¼ğŸ‰";
  fallArea.appendChild(msg);setTimeout(()=>msg.remove(),2500);
}
function confetti(){
  const colors=["#f44","#e91e63","#9c27b0","#3f51b5","#2196f3","#4caf50","#ffeb3b","#ff9800"];
  const rect=fallArea.getBoundingClientRect();
  for(let i=0;i<50;i++){
    const c=document.createElement("div");c.className="confetti";
    c.style.cssText="position:absolute;width:"+(6+Math.random()*6)+"px;height:"+(6+Math.random()*6)+"px;background:"+colors[Math.floor(Math.random()*8)]+";border-radius:"+(Math.random()>.5?"50%":"0")+";left:"+Math.random()*rect.width+"px;top:-10px;";
    fallArea.appendChild(c);
    let y=-10,x=parseFloat(c.style.left),vy=2+Math.random()*2,vx=(Math.random()-.5)*3,rot=0;
    (function anim(){y+=vy;x+=vx;rot+=5;vy+=0.1;c.style.top=y+"px";c.style.left=x+"px";c.style.transform="rotate("+rot+"deg)";if(y<rect.height+20)requestAnimationFrame(anim);else c.remove();})();
  }
}
function reset(){
  petals.forEach(p=>p.el.remove());petals=[];
  pool=getPool(rangeSelect.value);setupGrid(pool);setMissLimit(rangeSelect.value);
  score=0;missCount=0;milestones.clear();setLevel(1);
  scoreEl.textContent="0";missCountEl.textContent="0";spawnTimer=0;lastTime=null;
}
function spawn(){
  if(!pool.length)return;
  const e=pool[Math.floor(Math.random()*pool.length)];
  const rect=fallArea.getBoundingClientRect(),x=Math.random()*(rect.width-60)+10;
  const el=document.createElement("div");el.className="fall-petal";el.style.left=x+"px";el.style.top="-60px";
  el.innerHTML="<div>"+e.nameZh+"</div><div class='fall-num'>"+e.num+"</div>";
  fallArea.appendChild(el);
  petals.push({symbol:e.symbol,x,y:-60,speed:fallSpeed+Math.random()*0.08,sway:Math.random()*Math.PI*2,el});
}
function clickCell(sym,cell){
  if(!running)return;
  let hit=0;
  petals=petals.filter(p=>{if(p.symbol===sym){hit++;p.el.remove();return false;}return true;});
  if(hit){score+=hit;scoreEl.textContent=score;flash(cell,true);playSound("correct");checkLevel();checkMilestone();}
  else{flash(cell,false);playSound("wrong");}
}
function flash(c,ok){c.classList.remove("correct","wrong");void c.offsetWidth;c.classList.add(ok?"correct":"wrong");setTimeout(()=>c.classList.remove("correct","wrong"),350);}
function addMiss(){missCount++;missCountEl.textContent=missCount;updateDots();if(missCount>=missLimit)endGame();}
function endGame(manual){
  running=false;startBtn.disabled=false;endBtn.style.display="none";levelDisplay.style.display="none";
  overlay.style.display="flex";overlay.querySelector("h2").textContent="éŠæˆ²çµæŸ";
  const pass=Math.floor(score/200);
  let msg="å¾—åˆ†ï¼š"+score+" åˆ†";if(pass)msg+="<br>ğŸ† éé—œ "+pass+" æ¬¡ï¼";if(!manual)msg+="<br>éŒ¯èª¤å·²é”ä¸Šé™";
  overlay.querySelector("p").innerHTML=msg;playSound("end");
}
function loop(ts){
  if(!running)return;
  if(!lastTime)lastTime=ts;
  const dt=ts-lastTime;lastTime=ts;
  spawnTimer+=dt;
  if(spawnTimer>=spawnInterval/Math.min(1.5,1+score*0.005)){spawn();spawnTimer=0;}
  const rect=fallArea.getBoundingClientRect(),limitY=rect.height-45;
  petals=petals.filter(p=>{
    p.y+=p.speed*dt*0.05;p.sway+=0.015*dt;
    p.el.style.top=p.y+"px";p.el.style.left=(p.x+Math.sin(p.sway)*8)+"px";
    if(p.y>=limitY){p.el.remove();addMiss();return false;}return true;
  });
  if(running)requestAnimationFrame(loop);
}
function start(){reset();running=true;overlay.style.display="none";startBtn.disabled=true;endBtn.style.display="inline-block";levelDisplay.style.display="inline-block";requestAnimationFrame(loop);}
function playSound(t){
  if(!soundOn)return;
  const ctx=new(window.AudioContext||window.webkitAudioContext)(),osc=ctx.createOscillator(),g=ctx.createGain();
  osc.connect(g);g.connect(ctx.destination);
  if(t==="correct"){osc.frequency.value=800;g.gain.setValueAtTime(0.3,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.15);}
  else if(t==="wrong"){osc.frequency.value=220;g.gain.setValueAtTime(0.4,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.15);}
  else if(t==="end"){osc.frequency.value=140;g.gain.setValueAtTime(0.35,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.4);}
  else if(t==="levelup"){osc.frequency.setValueAtTime(600,ctx.currentTime);osc.frequency.exponentialRampToValueAtTime(1200,ctx.currentTime+0.2);g.gain.setValueAtTime(0.3,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.25);}
  else if(t==="celebrate"){osc.frequency.setValueAtTime(523,ctx.currentTime);osc.frequency.setValueAtTime(659,ctx.currentTime+0.1);osc.frequency.setValueAtTime(784,ctx.currentTime+0.2);g.gain.setValueAtTime(0.3,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.4);}
  osc.start();osc.stop(ctx.currentTime+0.5);
}
soundToggle.onclick=()=>{soundOn=!soundOn;soundToggle.classList.toggle("active",soundOn);soundToggle.textContent=soundOn?"é–‹":"é—œ";};
startBtn.onclick=start;overlayStart.onclick=start;
endBtn.onclick=()=>endGame(true);
reset();
</script>
</body>
</html>








